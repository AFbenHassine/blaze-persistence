== Set operations

// discuss basics about set operation and how they fit into ORM
// mention compatibility with dbms regarding non-distinct variants
// explain API support for normal builders, CTE builders and subquery builders
// especially regarding left nesting i.e. startSet() which starts a left group
// Mention limit and order by support and also that you can have "empty set groups" for dynamicity purposes + example


[[anchor-set-dbms-compatibility]]
=== DBMS compatibility

Currently there is no emulation implemented for databases that do not support CTEs natively.
CTEs are well tested with *PostgreSQL*, *DB2*, *Oracle* and *Microsoft SQL Server*. Many of the basic features work with *H2*, but beware that H2 support for CTEs is still experimental.

WARNING: We do not recommend using CTEs with H2 because of some very serious limitations. Using a CTE in an `IN` predicate or using `LIMIT` within the CTE have proven to produce wrong results. You also can't have multiple CTEs per query.

NOTE: DB2 does not support JOINs in the recursive part of a CTE: https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/com.ibm.db2z10.doc.codes/src/tpc/n345.dita

_CTEs in DML_ are uses of a CTE where the top level statement is a DML. In contrast, _Updatable CTEs_ are CTEs that *contain* DML and get their values from a `RETURNING` clause of the DML.

// TODO: When fixing #337 we could actually fallback to inlining for non-recursive CTEs on DBMS that don't support CTEs

[width="100%",options="header,footer"]
|====================
| *DBMS*     | UNION ALL    | UNION     | INTERSECT ALL | INTERSECT     | EXCEPT ALL    | EXCEPT
| PostgreSQL | yes          | yes       | yes           | yes           | yes           | yes
| MySQL      | yes          | yes       | no            | no            | no            | no

| H2         | yes          | yes       | no            | yes           | no            | yes
| Oracle     | yes          | yes       | yes           | yes           | yes           | yes
| SQL Server | yes          | yes       | yes           | yes           | yes           | yes
| DB2        | yes          | yes       | yes           | yes           | yes           | yes
|====================

[width="100%",options="header,footer"]
|====================
| *DBMS*     | Use in CTE   | Use in Subquery   | Subquery with LIMIT   | ORDER BY CASE
| PostgreSQL | yes          | yes               | yes                   | yes
| MySQL      | no           | yes               | yes                   | yes
| H2         | no ^1^       | yes               | no                    | yes
| Oracle     | yes          | yes               | yes                   | yes
| SQL Server | yes          | yes               | yes                   | no^2^
| DB2        | yes          | yes               | yes                   | yes
|====================
<1> Since CTEs are pretty much experimental in H2, you might encounter problems like with parameters
<2>